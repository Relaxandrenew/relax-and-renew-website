<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Successful | Relax & Renew RMT</title>
    
    <!-- ========================================== -->
    <!-- 1. GOOGLE GLOBAL SITE TAG                  -->
    <!-- ========================================== -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5E17NKVQXG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-5E17NKVQXG');
    </script>

    <!-- ========================================== -->
    <!-- 2. META PIXEL CODE (Facebook)              -->
    <!-- ========================================== -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    
    // Initialize Pixel with YOUR ID
    fbq('init', '701194265870298'); 
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=701194265870298&ev=PageView&noscript=1"
    /></noscript>
    <!-- ========================================== -->

    <!-- FONTS & ICONS -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- TAILWIND CONFIG -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            gold: '#E0C584',
                            goldHover: '#F0D594',
                            light: '#F0E2C0', 
                            dim: 'rgba(240, 226, 192, 0.6)',
                            black: '#050505',
                            dark: '#0a0a0a',
                            panel: 'rgba(20, 20, 20, 0.7)',
                        }
                    },
                    fontFamily: {
                        serif: ['"Cormorant Garamond"', 'serif'],
                    },
                    backgroundImage: {
                        'hero-pattern': "linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.9)), url('https://static.wixstatic.com/media/bf8fef_94f8be278f0f4b8abaee73b95d03b5e2~mv2.png')",
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 1s ease-out forwards',
                        'subtle-bounce': 'subtleBounce 3s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        subtleBounce: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-6px)' },
                        }
                    }
                }
            }
        };
    </script>

    <style>
        body { background-color: #050505; color: #F0E2C0; font-family: 'Cormorant Garamond', serif; font-size: 1.15rem; line-height: 1.7; overflow-x: hidden; }
        .fixed-nav { position: fixed; top: 0; left: 0; width: 100%; height: 80px; z-index: 50; background: rgba(5, 5, 5, 0.95); backdrop-filter: blur(15px); border-bottom: 1px solid rgba(224, 197, 132, 0.2); display: flex; align-items: center; }
        .card-fancy { background: linear-gradient(145deg, rgba(20,20,20,0.8), rgba(10,10,10,0.9)); border: 1px solid rgba(224, 197, 132, 0.1); backdrop-filter: blur(10px); transition: all 0.4s ease; padding: 3rem 2rem; position: relative; overflow: hidden; }
        .card-fancy::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg, transparent, #E0C584, transparent); transform: scaleX(0); transition: transform 0.5s ease; }
        .card-fancy:hover { transform: translateY(-2px); border-color: rgba(224, 197, 132, 0.3); }
        .card-fancy:hover::before { transform: scaleX(1); }
        .btn-gold { border: 1px solid #E0C584; color: #E0C584; padding: 0.8rem 2.5rem; text-transform: uppercase; font-weight: 700; letter-spacing: 0.1em; transition: 0.3s; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; cursor: pointer; text-decoration: none; }
        .btn-gold:hover { background: rgba(224, 197, 132, 0.1); color: #F0E2C0; border-color: #F0D594; box-shadow: 0 0 15px rgba(224, 197, 132, 0.2); }
        .btn-filled { background: #E0C584; color: #000; border: 1px solid #E0C584; padding: 0.8rem 2.5rem; text-transform: uppercase; font-weight: 700; letter-spacing: 0.1em; transition: 0.3s; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; cursor: pointer; text-decoration: none; }
        .btn-filled:hover { background: #F0D594; border-color: #F0D594; transform: translateY(-1px); box-shadow: 0 5px 15px rgba(224, 197, 132, 0.3); }
    </style>
</head>
<body class="bg-brand-black selection:bg-brand-gold selection:text-black flex flex-col min-h-screen">

    <!-- NAVIGATION BAR -->
    <nav class="fixed-nav">
        <div class="container mx-auto px-6 flex justify-between items-center h-full">
            <a href="/" class="flex items-center gap-3 no-underline group">
                <img src="https://static.wixstatic.com/media/bf8fef_511df25fad074d79a408119293545f75~mv2.png" alt="Relax & Renew Logo" class="h-10 w-auto transition-transform group-hover:scale-105">
                <div class="flex flex-col">
                    <span class="text-brand-gold font-bold tracking-[0.2em] text-sm leading-none">RELAX & RENEW</span>
                    <span class="text-brand-light text-[0.65rem] tracking-[0.4em] uppercase opacity-70 leading-tight mt-1">Mobile RMT</span>
                </div>
            </a>
            <a href="/" class="text-brand-gold hover:text-brand-light text-sm uppercase tracking-widest font-bold flex items-center gap-2">
                <i data-lucide="arrow-left" class="w-4 h-4"></i> Back to Home
            </a>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="flex-grow flex items-center justify-center relative bg-hero-pattern bg-cover bg-center bg-fixed bg-no-repeat pt-20">
        <div class="absolute inset-0 bg-gradient-to-b from-brand-black/40 via-brand-black/80 to-brand-black"></div>

        <div class="container mx-auto px-6 relative z-10 py-20">
            <div class="max-w-xl mx-auto">
                <div class="card-fancy text-center shadow-2xl animate-fade-in-up">
                    
                    <div class="mb-8 inline-flex items-center justify-center w-20 h-20 rounded-full border border-brand-gold/30 bg-brand-gold/5 text-brand-gold shadow-[0_0_20px_rgba(224,197,132,0.15)] animate-subtle-bounce">
                        <i data-lucide="check" class="w-10 h-10"></i>
                    </div>

                    <h1 class="text-4xl md:text-5xl text-brand-light mb-4 font-serif italic">Payment Successful</h1>
                    
                    <div class="w-16 h-px bg-brand-gold mx-auto mb-8"></div>

                    <!-- DYNAMIC AMOUNT DISPLAY -->
                    <div id="amount-container" class="mb-8 opacity-0 transition-opacity duration-1000 transform translate-y-2">
                        <span class="text-brand-dim uppercase tracking-widest text-[10px] block mb-2">Total Amount</span>
                        <div class="text-4xl text-brand-gold font-bold" id="display-amount">...</div>
                    </div>

                    <p class="text-xl text-brand-dim font-light leading-relaxed mb-8">
                        Thank you for your purchase. Your gift card has been generated and <span class="text-brand-gold">emailed to you instantly.</span>
                    </p>

                    <div class="bg-brand-black/40 border border-brand-gold/10 p-6 rounded mb-8 text-sm">
                        <p class="text-brand-light/80 mb-2 font-bold uppercase tracking-widest text-xs">Next Steps</p>
                        <p class="text-brand-dim font-light">
                            Please check your inbox (and junk folder) for an email from <br>
                            <span class="text-brand-gold">info@relaxandrenew.ca</span>
                        </p>
                    </div>

                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <a href="/" class="btn-filled">Return to Home</a>
                        <a href="https://relaxandrenew.noterro.com" class="btn-gold">Book Appointment</a>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="bg-neutral-950 py-12 border-t border-brand-gold/20 relative z-20">
        <div class="container mx-auto px-6 text-center">
            <div class="flex justify-center items-center gap-2 mb-6 opacity-70">
                <img src="https://static.wixstatic.com/media/bf8fef_511df25fad074d79a408119293545f75~mv2.png" alt="Logo" class="h-6 w-auto">
                <span class="text-brand-gold tracking-widest font-bold text-sm">RELAX & RENEW</span>
            </div>
            <p class="text-brand-dim/40 text-xs uppercase tracking-widest mb-6">Professional Mobile Massage Therapy â€¢ Niagara Region</p>
            <div class="text-xs text-brand-dim/20">
                <p>&copy; 2025-2026 Relax & Renew RMT. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- ICONS -->
    <script>
        lucide.createIcons();
    </script>

    <!-- ============================================== -->
    <!-- DYNAMIC TRACKING SCRIPT (Google + Meta)        -->
    <!-- ============================================== -->
    <script>
        document.addEventListener("DOMContentLoaded", async function() {
            
            // 1. Find the Session ID in the URL
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session_id');
            
            const amountContainer = document.getElementById('amount-container');
            const displayAmount = document.getElementById('display-amount');
            
            // Default Fallback
            let finalValue = 50.00; 
            let currency = 'CAD';

            if (sessionId) {
                console.log("Session ID found:", sessionId);
                try {
                    // 2. Call YOUR Webhook
                    // NEW: choose test vs production n8n endpoint based on session prefix
                    const n8nBase = 'https://primary-production-efcf.up.railway.app';
                    const isTestSession = sessionId.startsWith('cs_test_');
                    const n8nPath = isTestSession
                        ? '/webhook-test/get-session-details'
                        : '/webhook/get-session-details';

                    const response = await fetch(`${n8nBase}${n8nPath}?session_id=${encodeURIComponent(sessionId)}`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.amount) {
                            finalValue = parseFloat(data.amount); 
                            displayAmount.innerText = new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD' }).format(finalValue);
                            amountContainer.classList.remove('opacity-0');
                        }
                    }
                } catch (e) {
                    console.warn("Could not fetch dynamic amount, showing standard confirmation.");
                    displayAmount.innerText = "Confirmed"; 
                    amountContainer.classList.remove('opacity-0');
                }
            } else {
                displayAmount.innerText = "Confirmed";
                amountContainer.classList.remove('opacity-0');
            }

            // 4. Send Events to Both Platforms
            setTimeout(() => {
                // GOOGLE ADS
                if (typeof gtag === 'function') {
                    gtag('event', 'conversion', {
                        'send_to': 'AW-17575022013/8loLCPWb1MgbEL2btrxB',
                        'value': finalValue,
                        'currency': currency,
                        'transaction_id': sessionId || ''
                    });
                    console.log(`Google Ads Conversion Sent: $${finalValue}`);
                }

                // META (FACEBOOK) PIXEL
                if (typeof fbq === 'function') {
                    fbq('track', 'Purchase', {
                        value: finalValue,
                        currency: currency,
                        content_name: 'Gift Card',
                        content_type: 'product'
                    });
                    console.log(`Meta Pixel Purchase Sent: $${finalValue}`);
                }
            }, 500);
        });
    </script>
</body>
</html>
