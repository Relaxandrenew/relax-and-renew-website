<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Portal | Relax & Renew RMT</title>
    <meta name="description" content="Secure client portal for Relax & Renew RMT. View your profile, appointments, and receipts.">

    <!-- Meta Pixel -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '701194265870298');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=701194265870298&ev=PageView&noscript=1"
    /></noscript>

    <!-- Google Analytics / Ads -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17575022013"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-J4NC9FL44H');   // GA4 Property
      gtag('config', 'AW-17575022013'); // Google Ads Account
    </script>

    <!-- Suppress noisy third-party errors -->
    <script>
        window.onerror = function(msg, url, line, col, error) {
            if (!url || (msg && String(msg).toLowerCase().indexOf("script error") > -1)) {
                return true;
            }
            return false;
        };
        window.addEventListener('unhandledrejection', function(event) {
            event.preventDefault();
        });
    </script>

    <!-- Tailwind + Brand Config -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            gold: '#E0C584',
                            goldHover: '#F0D594',
                            light: '#F0E2C0', 
                            dim: 'rgba(240, 226, 192, 0.6)',
                            black: '#050505',
                            dark: '#0a0a0a',
                            panel: 'rgba(20, 20, 20, 0.7)',
                        }
                    },
                    fontFamily: {
                        serif: ['"Cormorant Garamond"', 'serif'],
                    },
                    backgroundImage: {
                        'hero-pattern': "linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.9)), url('https://static.wixstatic.com/media/bf8fef_94f8be278f0f4b8abaee73b95d03b5e2~mv2.png')",
                        'alternate-pattern': "linear-gradient(to bottom, rgba(0,0,0,0.8), rgba(0,0,0,0.95)), url('https://static.wixstatic.com/media/bf8fef_7776f5b067be4025a75ed7e149bb1d7e~mv2.jpg')"
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                        'subtle-bounce': 'subtleBounce 3s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        subtleBounce: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-6px)' },
                        }
                    }
                }
            }
        };
    </script>

    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <!-- Auth0 Lock (Embedded Email + Password Window) -->
    <link rel="stylesheet" href="https://cdn.auth0.com/js/lock/11.36.2/lock.min.css" />
    <script src="https://cdn.auth0.com/js/lock/11.36.2/lock.min.js"></script>

    <style>
        body { 
            background-color: #050505; 
            color: #F0E2C0; 
            font-family: 'Cormorant Garamond', serif; 
            font-size: 1.15rem; 
            line-height: 1.7; 
            overflow-x: hidden; 
        }
        html { scroll-behavior: smooth; font-size: 18px; }

        .card-fancy { 
            background: linear-gradient(145deg, rgba(20,20,20,0.8), rgba(10,10,10,0.9)); 
            border: 1px solid rgba(224, 197, 132, 0.1); 
            backdrop-filter: blur(10px); 
            transition: all 0.4s ease; 
            padding: 2.0rem 1.8rem; 
            position: relative; 
            overflow: hidden; 
        }
        .card-fancy::before { 
            content: ''; 
            position: absolute; 
            top: 0; left: 0; 
            width: 100%; height: 2px; 
            background: linear-gradient(90deg, transparent, #E0C584, transparent); 
            transform: scaleX(0); 
            transition: transform 0.5s ease; 
        }
        .card-fancy:hover { 
            transform: translateY(-4px); 
            border-color: rgba(224, 197, 132, 0.3); 
        }
        .card-fancy:hover::before { 
            transform: scaleX(1); 
        }

        .btn-gold { 
            border: 1px solid #E0C584; 
            color: #E0C584; 
            padding: 0.6rem 2rem; 
            text-transform: uppercase; 
            font-weight: 700; 
            letter-spacing: 0.1em; 
            transition: 0.3s; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            gap: 0.5rem; 
            cursor: pointer; 
        }
        .btn-gold:hover { 
            background: rgba(224, 197, 132, 0.1); 
            color: #F0E2C0; 
            border-color: #F0D594; 
            box-shadow: 0 0 15px rgba(224, 197, 132, 0.2); 
        }

        .btn-filled { 
            background: #E0C584; 
            color: #000; 
            border: 1px solid #E0C584; 
            padding: 0.6rem 2rem; 
            text-transform: uppercase; 
            font-weight: 700; 
            letter-spacing: 0.1em; 
            transition: 0.3s; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            gap: 0.5rem; 
            cursor: pointer; 
        }
        .btn-filled:hover { 
            background: #F0D594; 
            border-color: #F0D594; 
            transform: translateY(-1px); 
            box-shadow: 0 5px 15px rgba(224, 197, 132, 0.3); 
        }

        .hidden { display: none; }

        /* Make Lock blend slightly better on dark background (best-effort) */
        .auth0-lock.auth0-lock .auth0-lock-header { display: none !important; }
        .auth0-lock.auth0-lock .auth0-lock-widget { box-shadow: none !important; border-radius: 14px !important; }

        /* Match header typography to site (booknowtest) */
        nav, nav * { font-family: 'Cormorant Garamond', serif !important; }


        /* Header nav typography to match site (all caps + tracking) */
        nav a {
            text-transform: uppercase !important;
            letter-spacing: 0.18em !important;
            font-weight: 700 !important;
        }
        /* Keep secondary line under logo from being forced uppercase spacing too aggressively */
        nav a img, nav img { text-transform: none !important; letter-spacing: normal !important; }

    
        /* Header links: match booknowtest (size/weight/tracking/uppercase) */
        nav .hidden.lg\:flex a,
        #mob-menu a {
            text-transform: uppercase !important;
            font-size: 0.78rem !important;
            letter-spacing: 0.12em !important;
        }
        nav .hidden.lg\:flex a:not(.font-bold),
        #mob-menu a:not(.font-bold) {
            font-weight: 600 !important;
        }

</style>
</head>
<body class="bg-brand-black selection:bg-brand-gold selection:text-black relative">

    <!-- ORIGINAL THIN HEADER BAR -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-black/80 backdrop-blur-md border-b border-brand-gold/15">
        <div class="max-w-7xl mx-auto px-12 h-16 flex items-center justify-between">
            <a href="index.html" class="flex items-center gap-3 no-underline group">
                <img src="https://static.wixstatic.com/media/bf8fef_511df25fad074d79a408119293545f75~mv2.png"
                     alt="Relax & Renew"
                     class="h-9 w-auto opacity-90 transition-transform duration-200 group-hover:scale-105" />
                <div class="hidden md:flex flex-col leading-none">
                    <span class="text-brand-gold font-bold tracking-[0.2em] text-xs">RELAX &amp; RENEW</span>
                    <span class="text-brand-dim text-[0.65rem] tracking-[0.4em] uppercase opacity-70 mt-1">Mobile RMT</span>
                </div>
            </a>

            <div class="hidden lg:flex items-center space-x-8 whitespace-nowrap text-sm">
                <a href="index.html#services" class="text-brand-dim hover:text-brand-gold transition-colors">Services</a>
                <a href="index.html#pricing" class="text-brand-dim hover:text-brand-gold transition-colors">Pricing</a>
                <a href="index.html#giftcards" class="text-brand-dim hover:text-brand-gold transition-colors">Gift Cards</a>
                <a href="index.html#area" class="text-brand-dim hover:text-brand-gold transition-colors">Service Area</a>
                <a href="index.html#faq" class="text-brand-dim hover:text-brand-gold transition-colors">FAQ</a>
                <a href="therapists.html" class="text-brand-dim hover:text-brand-gold transition-colors">Our Therapists</a>
                <a href="membership.html" class="text-brand-gold font-bold hover:text-brand-goldHover transition-colors">Membership</a>
                <a href="client-portal.html" class="text-brand-gold font-bold hover:text-brand-goldHover transition-colors flex items-center gap-2">
                    <i data-lucide="user" class="w-4 h-4"></i>
                    <span>My Portal</span>
                </a>
            </div>

            <button id="menu-btn" class="lg:hidden text-brand-gold p-2 focus:outline-none hover:text-brand-goldHover transition-colors" aria-label="Open menu" type="button">
                <i data-lucide="menu" class="w-8 h-8"></i>
            </button>
        </div>

        <!-- Mobile menu -->
        <div id="mob-menu" class="fixed top-0 right-0 h-full w-full max-w-sm bg-black/95 border-l border-brand-gold/20 transform translate-x-full transition-transform duration-300 z-50">
            <div class="h-16 px-6 flex items-center justify-between border-b border-brand-gold/15">
                <div class="text-brand-gold font-serif text-xl">Menu</div>
                <button id="menu-close" class="text-brand-gold p-2 hover:text-brand-goldHover transition-colors" aria-label="Close menu" type="button">
                    <i data-lucide="x" class="w-8 h-8"></i>
                </button>
            </div>
            <div class="p-6 space-y-4 text-lg">
                <a href="index.html#services" class="block text-brand-light hover:text-brand-gold transition-colors">Services</a>
                <a href="index.html#pricing" class="block text-brand-light hover:text-brand-gold transition-colors">Pricing</a>
                <a href="index.html#giftcards" class="block text-brand-light hover:text-brand-gold transition-colors">Gift Cards</a>
                <a href="index.html#area" class="block text-brand-light hover:text-brand-gold transition-colors">Service Area</a>
                <a href="index.html#faq" class="block text-brand-light hover:text-brand-gold transition-colors">FAQ</a>
                <a href="therapists.html" class="block text-brand-light hover:text-brand-gold transition-colors">Our Therapists</a>
                <a href="membership.html" class="block text-brand-gold font-bold hover:text-brand-goldHover transition-colors">Membership</a>
                <a href="client-portal.html" class="block text-brand-gold font-bold hover:text-brand-goldHover transition-colors">My Portal</a>
            </div>
        </div>
    </nav>

    <!-- Spacer to prevent fixed header overlap -->
    <div aria-hidden="true" class="h-16"></div>

    <!-- MAIN PORTAL CONTENT -->
    <main class="py-16 bg-alternate-pattern bg-cover bg-center bg-fixed relative">
        <div class="absolute inset-0 bg-brand-black/65"></div>
        <div class="relative z-10 container mx-auto px-10 max-w-7xl">
            <div class="grid lg:grid-cols-[1.1fr,0.9fr] gap-10 items-start">

                <!-- LEFT COLUMN: OVERVIEW (UNCHANGED) -->
                <section class="space-y-6 animate-fade-in-up">
                    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-brand-gold/30 bg-black/40 text-[0.7rem] tracking-[0.22em] uppercase text-brand-gold/80">
                        <i data-lucide="shield-check" class="w-3.5 h-3.5"></i>
                        Secure Client Portal
                    </div>

                    <h1 class="text-4xl md:text-5xl text-brand-light mt-4 mb-2 leading-tight">
                        Your Massage History, Receipts &amp; Bookings in One Place
                    </h1>

                    <p class="text-brand-dim text-base max-w-2xl">
                        Sign in to your Relax &amp; Renew Client Portal to review past sessions, see upcoming bookings,
                        download receipts for insurance, and keep your address and preferences up to date — all under a secure login.
                    </p>

                    <div class="grid md:grid-cols-3 gap-4 mt-6 text-sm">
                        <div class="card-fancy">
                            <div class="flex items-center gap-2 mb-3">
                                <i data-lucide="user" class="w-5 h-5 text-brand-gold"></i>
                                <span class="text-xs tracking-[0.18em] uppercase text-brand-gold/90">Profile</span>
                            </div>
                            <p class="text-brand-dim text-sm">
                                Confirm your contact details, service address, and preferred city so we can calculate
                                travel time and availability accurately.
                            </p>
                        </div>
                        <div class="card-fancy">
                            <div class="flex items-center gap-2 mb-3">
                                <i data-lucide="calendar-clock" class="w-5 h-5 text-brand-gold"></i>
                                <span class="text-xs tracking-[0.18em] uppercase text-brand-gold/90">Appointments</span>
                            </div>
                            <p class="text-brand-dim text-sm">
                                View past and upcoming massage appointments, with drive-time aware scheduling coming soon.
                            </p>
                        </div>
                        <div class="card-fancy">
                            <div class="flex items-center gap-2 mb-3">
                                <i data-lucide="file-text" class="w-5 h-5 text-brand-gold"></i>
                                <span class="text-xs tracking-[0.18em] uppercase text-brand-gold/90">Receipts</span>
                            </div>
                            <p class="text-brand-dim text-sm">
                                Access treatment receipts and invoices to submit to your extended health insurance provider.
                            </p>
                        </div>
                    </div>

                    <p class="text-xs text-brand-dim/70 mt-4 max-w-xl">
                        Note: This portal is for returning clients only. New to Relax &amp; Renew?
                        You can still <a href="/portal.html" class="text-brand-gold underline hover:text-brand-light">book your first session here</a> — 
                        we will create your portal login after your first visit.
                    </p>
                </section>

                <!-- RIGHT COLUMN: SIGN IN WINDOW (ONLY CHANGED AREA) -->
                <aside class="card-fancy max-w-xl mx-auto w-full">
                    <div class="flex items-center gap-2 mb-2 text-xs tracking-[0.2em] uppercase text-brand-gold/80">
                        <i data-lucide="lock" class="w-4 h-4"></i>
                        Sign in
                    </div>
                    <h2 class="text-2xl text-brand-light mb-2">Email &amp; Password</h2>
                    <p class="text-brand-dim text-sm mb-5">
                        If you just set your password from the welcome link, you can sign in now.
                    </p>

                    <div id="auth0-lock-container"></div>

                    <p class="text-[11px] text-brand-dim/80 leading-snug mt-4">
                        By logging in, you agree to our
                        <a href="/privacy-policy" class="underline text-brand-gold hover:text-brand-light">Privacy Policy</a>
                        and
                        <a href="/terms" class="underline text-brand-gold hover:text-brand-light">Terms</a>.
                    </p>

                    <div id="auth0-error" class="hidden mt-4 text-sm border border-red-500/30 bg-red-500/10 rounded-lg p-3"></div>
                </aside>
            </div>
        </div>
    </main>

    <!-- FOOTER (UNCHANGED) -->
    <footer class="bg-neutral-950 py-10 border-t border-brand-gold/20 text-center">
        <div class="container mx-auto px-10">
            <p class="text-brand-dim/60 text-sm mb-4">
                Professional, registered mobile massage therapy across Niagara Region.
            </p>
            <div class="flex justify-center gap-6 text-brand-gold mb-6">
                <a href="https://www.facebook.com/share/1F1fYU6yrF/" target="_blank" class="hover:text-brand-light transition-colors bg-brand-light/5 p-2 rounded-full">
                    <i data-lucide="facebook" class="w-4 h-4"></i>
                </a>
                <a href="mailto:info@relaxandrenew.ca" class="hover:text-brand-light transition-colors bg-brand-light/5 p-2 rounded-full">
                    <i data-lucide="mail" class="w-4 h-4"></i>
                </a>
            </div>
            <a href="/index.html" class="text-brand-gold hover:text-brand-light text-sm underline">
                Return to Main Website
            </a>
        </div>
    </footer>

    <!-- AUTH0 LOCK LOGIC -->
    <script>
        // Render icons
        document.addEventListener('DOMContentLoaded', function() {
            try { if (typeof lucide !== 'undefined') lucide.createIcons(); } catch(e) {}
        });

        // ===== AUTH0 CONFIG =====
        const AUTH0_DOMAIN = "dev-sbhcygzz4xcoa2ij.us.auth0.com";
        const AUTH0_CLIENT_ID = "T8FERqkpcryRN77voMnLeaXIkha1eqK1";
        const AUTH0_DB_CONNECTION = "Username-Password-Authentication";

        // Redirect after successful login
        const AFTER_LOGIN_REDIRECT = "https://www.relaxandrenew.ca/client-portal";

        function showAuthError(msg) {
            const el = document.getElementById('auth0-error');
            if (!el) return;
            el.textContent = msg || "Sign in failed. Please try again.";
            el.classList.remove('hidden');
        }

        // If we are already ON the portal target, do not redirect-loop.
        function safeRedirect() {
            try {
                const here = window.location.href;
                if (AFTER_LOGIN_REDIRECT && !here.startsWith(AFTER_LOGIN_REDIRECT)) {
                    window.location.href = AFTER_LOGIN_REDIRECT;
                }
            } catch (e) {}
        }

        // Create Lock
        const lock = new Auth0Lock(AUTH0_CLIENT_ID, AUTH0_DOMAIN, {
            container: 'auth0-lock-container',
            theme: {
                logo: 'https://static.wixstatic.com/media/bf8fef_511df25fad074d79a408119293545f75~mv2.png',
                primaryColor: '#E0C584'
            },
            languageDictionary: { title: "" },
            auth: {
                redirect: false,
                responseType: 'token id_token',
                sso: false,
                params: { scope: 'openid profile email' }
            },
            allowedConnections: [AUTH0_DB_CONNECTION],
            rememberLastLogin: true,
            autofocus: true,
            autoclose: true,
            closable: false
        });

        // Show the embedded window immediately
        lock.show();

        lock.on('authenticated', function(authResult) {
            try {
                if (authResult && authResult.accessToken) {
                    localStorage.setItem('rnr_auth_token', authResult.accessToken);
                }
                if (authResult && authResult.idToken) {
                    localStorage.setItem('rnr_id_token', authResult.idToken);
                }

                try {
                    if (typeof gtag === "function") gtag("event", "client_portal_login_success");
                    if (typeof fbq === "function") fbq("trackCustom", "ClientPortalLoginSuccess");
                } catch (e) {}

                safeRedirect();
            } catch (e) {
                showAuthError("Sign in succeeded but redirect failed. Please refresh and try again.");
            }
        });

        lock.on('authorization_error', function(err) {
            console.error('Auth0 authorization_error:', err);
            showAuthError("Sign in failed. Please check your email/password and try again.");
        });
    </script>

    <!-- Mobile menu logic (UNCHANGED) -->
    <script>
        (function () {
            const mobMenu = document.getElementById('mob-menu');
            const openBtn = document.getElementById('menu-btn');
            const closeBtn = document.getElementById('menu-close');

            function openMenu() { mobMenu?.classList.remove('translate-x-full'); }
            function closeMenu() { mobMenu?.classList.add('translate-x-full'); }

            openBtn?.addEventListener('click', openMenu);
            closeBtn?.addEventListener('click', closeMenu);

            mobMenu?.querySelectorAll('a').forEach(a => a.addEventListener('click', closeMenu));

            try { if (window.lucide) window.lucide.createIcons(); } catch (e) {}
        })();
    </script>
</body>
</html>
